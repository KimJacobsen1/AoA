<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Age of Adventure – Character, Companion & Hireling Tools</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500&family=EB+Garamond&display=swap" rel="stylesheet">
<style>
  :root{--ink:#2c2c2c;--paper:#f4f0e6;--panel:#fffdf9;--sheet:#fffef9;--gold:#b8a97f;--head:#3a2c1a}
  *{box-sizing:border-box}
  body{font-family:"EB Garamond",serif;background:var(--paper);margin:0;padding:20px;color:var(--ink)}
  h1{font-family:"Cinzel",serif;text-align:center;font-size:2.4em;margin:8px 0 18px;color:var(--head)}
  h2{font-family:"Cinzel",serif;color:var(--head);border-bottom:1px solid var(--gold);padding-bottom:4px;margin:6px 0 12px}
  h3,h4{font-family:"Cinzel",serif;margin:8px 0}
  .step,.panel{border:2px solid var(--gold);padding:18px;margin:18px auto;border-radius:10px;background:var(--panel);max-width:980px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
  .sheet{border:2px solid var(--gold);padding:16px 18px;margin:22px auto;border-radius:12px;background:var(--sheet);max-width:820px;box-shadow:0 6px 18px rgba(0,0,0,.12)}
  .sheet h2{text-align:center;margin-bottom:10px}
  .section{margin:10px 0 16px}
  .section h4{margin:0 0 6px;font-size:1.05em;color:var(--head)}
  .hr{height:1px;background:var(--gold);opacity:.85;border:0;margin:10px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .grow{flex:1 1 260px}
  input,textarea,select{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;font:inherit;margin:6px 0}
  textarea{min-height:80px}
  ul{margin:0;padding-left:20px}
  li{margin:2px 0}
  .btn{margin:6px 4px;padding:10px 14px;border:0;border-radius:6px;font:inherit;font-weight:700;cursor:pointer;transition:transform .15s,background .25s}
  .next-btn{background:#6a5234;color:#fff}.next-btn:hover{background:#856947;transform:scale(1.05)}
  .link-btn{background:#27568c;color:#fff}.link-btn:hover{background:#2f6dad;transform:scale(1.05)}
  .print-btn{background:#2f6d3f;color:#fff}.print-btn:hover{background:#3f8a55;transform:scale(1.05)}
  .reset-btn{background:#7d2f2f;color:#fff}.reset-btn:hover{background:#a14444;transform:scale(1.05)}
  .buy-btn{background:#8b7355;color:#fff;padding:6px 10px;margin:3px;font-size:.92em}.buy-btn:hover{background:#a18767;transform:scale(1.05)}
  .choice-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:14px}
  .choice-card{border:2px solid var(--gold);border-radius:12px;background:#fffefb;padding:18px;text-align:center}
  .avatar{width:140px;height:140px;border:2px solid var(--gold);border-radius:10px;object-fit:cover;background:#eee}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .tools-grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
  .muted{color:#6d5b3f;font-style:italic}
  .hidden{display:none !important}
  @media print{
    body{background:#fff}
    body *{visibility:hidden !important;height:0 !important}
    .printing,.printing *{visibility:visible !important;height:auto !important}
    .printing{position:absolute;left:0;top:0;width:100%;margin:0;border:0;box-shadow:none}
  }
</style>
</head>
<body>

<h1>Age of Adventure – Tools by Nylo</h1>

<!-- HOME -->
<div class="panel" id="home">
  <h2>What would you like to do?</h2>
  <div class="choice-grid">
    <div class="choice-card">
      <h3>Create Character</h3>
      <p class="muted">Walk through steps, then export to PDF or Discord.</p>
      <button class="btn next-btn" onclick="route('char-1')">Start Character Creator</button>
    </div>
    <div class="choice-card">
      <h3>Design Animal Companion</h3>
      <p class="muted">Pick size and details. Export too.</p>
      <button class="btn link-btn" onclick="route('ally')">Open Companion Designer</button>
    </div>
    <div class="choice-card">
      <h3>Design Hireling</h3>
      <p class="muted">Use the hireling statline, choose skills, export.</p>
      <button class="btn link-btn" onclick="route('hire')">Open Hireling Designer</button>
    </div>
    <div class="choice-card">
      <h3>Look in the General Store</h3>
      <p class="muted">Browse items and descriptions.</p>
      <button class="btn link-btn" onclick="route('store')">Open General Store</button>
    </div>
  </div>
</div>

<!-- ========== CHARACTER CREATOR (steps) ========== -->
<div class="step hidden" id="char-1">
  <h2>Step 1: Community & Role</h2>
  <div class="grid2">
    <label>Community
      <select id="community" onchange="onCommunityChange()">
        <option value="">-- Select --</option>
        <option>Dwarf</option><option>Elf</option><option>Goblin</option>
        <option>Halfling</option><option>Human</option><option>Orc</option>
        <option value="__custom__">Custom Community…</option>
      </select>
    </label>
    <label>Role
      <select id="role" onchange="onRoleChange()">
        <option value="">-- Select --</option>
        <option>Archer</option><option>Barbarian</option><option>Cleric</option>
        <option>Rogue</option><option>Warrior</option><option>Wizard</option>
        <option value="__custom__">Custom Role…</option>
      </select>
    </label>
  </div>

  <!-- Custom community fields -->
  <div id="customCommunityBox" class="panel hidden">
    <h3>Custom Community</h3>
    <div class="grid2">
      <label class="grow">Community Name
        <input id="customCommunityName" type="text" placeholder="e.g., Aetherborn" oninput="updateChar()">
      </label>
      <div class="grow"></div>
      <label class="grow">Community Skill 1
        <input id="customCommunitySkill1" type="text" placeholder="e.g., Sky-Navigation" oninput="updateChar()">
      </label>
      <label class="grow">Community Skill 2
        <input id="customCommunitySkill2" type="text" placeholder="e.g., Storm Sense" oninput="updateChar()">
      </label>
    </div>
    <p class="muted">Languages will include <strong>Common</strong> and <strong>&lt;Community Name&gt; tongue</strong>.</p>
  </div>

  <!-- Custom role fields -->
  <div id="customRoleBox" class="panel hidden">
    <h3>Custom Role</h3>
    <div class="grid2">
      <label class="grow">Role Name
        <input id="customRoleName" type="text" placeholder="e.g., Battledancer" oninput="updateChar()">
      </label>
      <div class="grow"></div>
      <label class="grow">Role Skill 1
        <input id="customRoleSkill1" type="text" placeholder="e.g., Flowing Strike" oninput="updateChar()">
      </label>
      <label class="grow">Role Skill 2
        <input id="customRoleSkill2" type="text" placeholder="e.g., Whirl Evasion" oninput="updateChar()">
      </label>
    </div>
  </div>

  <div>
    <button class="btn next-btn" onclick="route('char-2')">Next</button>
    <button class="btn reset-btn" onclick="route('home'); resetAll()">Back</button>
  </div>
</div>

<div class="step hidden" id="char-2">
  <h2>Step 2: Proficiency</h2>
  <input type="number" id="prof" min="2" max="5" onchange="updateChar()">
  <div>
    <button class="btn next-btn" onclick="route('char-3')">Next</button>
    <button class="btn reset-btn" onclick="route('char-1')">Back</button>
  </div>
</div>

<div class="step hidden" id="char-3">
  <h2>Step 3: Name</h2>
  <input type="text" id="name" placeholder="Hero Name" oninput="updateChar()">
  <div>
    <button class="btn next-btn" onclick="route('char-4')">Next</button>
    <button class="btn reset-btn" onclick="route('char-2')">Back</button>
  </div>
</div>

<div class="step hidden" id="char-4">
  <h2>Step 4: Homeland</h2>
  <input type="text" id="home" placeholder="Homeland" oninput="updateChar()">
  <div>
    <button class="btn next-btn" onclick="route('char-5')">Next</button>
    <button class="btn reset-btn" onclick="route('char-3')">Back</button>
  </div>
</div>

<div class="step hidden" id="char-5">
  <h2>Step 5: Goal</h2>
  <input type="text" id="goal" placeholder="Hero Goal" oninput="updateChar()">
  <div>
    <button class="btn next-btn" onclick="route('char-6')">Next</button>
    <button class="btn reset-btn" onclick="route('char-4')">Back</button>
  </div>
</div>

<div class="step hidden" id="char-6">
  <h2>Step 6: Appearance & Image</h2>
  <div class="row">
    <img id="avatar" class="avatar" alt="Character image preview">
    <div class="grow">
      <textarea id="app" placeholder="Describe your hero..." oninput="updateChar()"></textarea>
      <label class="muted">Upload image (JPG/PNG/GIF)
        <input type="file" id="imgInput" accept="image/*" onchange="loadAvatar(event)">
      </label>
      <div><button class="btn link-btn" onclick="downloadAvatar()">Download Image</button></div>
    </div>
  </div>
  <div>
    <button class="btn next-btn" onclick="route('char-7')">Next</button>
    <button class="btn reset-btn" onclick="route('char-5')">Back</button>
  </div>
</div>

<div class="step hidden" id="char-7">
  <h2>Step 7: Languages</h2>
  <p>All heroes know <strong>Common</strong>. Non-humans also know their Community tongue. Humans may choose <strong>two extra</strong> languages:</p>
  <div id="languageChoice" class="hidden">
    <select id="extraLang" multiple size="6" onchange="updateChar()">
      <option value="Dwarvish">Dwarvish</option>
      <option value="Elvish">Elvish</option>
      <option value="Goblin Tongue">Goblin Tongue</option>
      <option value="Halfling Speech">Halfling Speech</option>
      <option value="Orcish">Orcish</option>
      <option value="Other">Other</option>
    </select>
    <p class="muted"><em>Hold CTRL (Windows) or CMD (Mac) to select two.</em></p>
  </div>
  <div>
    <button class="btn next-btn" onclick="route('char-8')">Next</button>
    <button class="btn reset-btn" onclick="route('char-6')">Back</button>
  </div>
</div>

<div class="step hidden" id="char-8">
  <h2>Step 8: Equipment & Output</h2>
  <div class="tools-grid">
    <div class="panel">
      <h3>Buy Equipment</h3>
      <p><strong>Pouch:</strong> <span id="gold">-</span> GP | <span id="silver">-</span> SP</p>

      <div class="row" style="align-items:center">
        <label class="grow">Other (Pouch for gems, personal and mundane items; Equipment for slots)
          <input id="pouchOtherInput" type="text" placeholder="e.g., small ruby; journal; pipe">
        </label>
        <label><input type="radio" name="otherDest" value="pouch" checked> To Pouch</label>
        <label><input type="radio" name="otherDest" value="equipment"> To Equipment</label>
        <button class="btn link-btn" onclick="addOther()">Add</button>
      </div>

      <h4>1 GP Items</h4><div id="shop1"></div>
      <h4>3 GP Items</h4><div id="shop3"></div>
      <h4>6 GP Items</h4><div id="shop6"></div>
      <div><button class="btn link-btn" onclick="undoLastPurchase()">Undo last purchase</button></div>
    </div>

    <div class="panel">
      <h3>Discord Style</h3>
      <label>Divider
        <select id="dsDivider">
          <option value="dash" selected>──────── (light)</option>
          <option value="double">════════ (double)</option>
          <option value="heavy">━━━━━━━━ (heavy)</option>
          <option value="equals">================================ (equals)</option>
        </select>
      </label><br>
      <label>Heading Font
        <select id="dsFont">
          <option value="normal" selected>Normal</option>
          <option value="bold">Bold (Unicode)</option>
          <option value="smallcaps">Small Caps (Unicode)</option>
        </select>
      </label><br>
      <label>Heading Color
        <select id="dsColor">
          <option value="none" selected>None</option>
          <option value="green">Green</option>
          <option value="blue">Blue</option>
          <option value="red">Red</option>
          <option value="yellow">Yellow</option>
          <option value="magenta">Magenta</option>
          <option value="cyan">Cyan</option>
          <option value="white">White</option>
          <option value="gray">Gray</option>
        </select>
      </label><br>
      <label>Headline Frame
        <select id="dsFrame">
          <option value="none" selected>None</option>
          <option value="brackets">[ Title ]</option>
          <option value="rounded">╭ Title ╮</option>
          <option value="heavy">┏ Title ┓</option>
          <option value="double">╔ Title ╗</option>
        </select>
      </label>
      <hr class="hr">
      <button class="btn print-btn" onclick="printSheet('charSheet')">Download PDF</button>
      <button class="btn next-btn" onclick="copyDiscordChar()">Copy for Discord</button>
      <button class="btn reset-btn" onclick="resetAll()">Reset</button>
    </div>
  </div>
</div>

<!-- CHARACTER SHEET -->
<div class="sheet hidden" id="charSheet">
  <h2>Character Sheet</h2>
  <div class="section">
    <h4>Identity</h4><div class="hr"></div>
    <div class="row" style="align-items:center">
      <img id="avatarSheet" class="avatar" alt="Character image" style="display:none">
      <div class="grow">
        <p><strong>Name:</strong> <span id="outName">-</span></p>
        <p><strong>Homeland:</strong> <span id="outHome">-</span></p>
        <p><strong>Community:</strong> <span id="outCommunity">-</span></p>
        <p><strong>Role:</strong> <span id="outRole">-</span></p>
        <p><strong>Goal:</strong> <span id="outGoal">-</span></p>
        <p><strong>Appearance:</strong> <span id="outApp">-</span></p>
      </div>
    </div>
  </div>

  <div class="section">
    <h4>Stats</h4><div class="hr"></div>
    <p><strong>Proficiency:</strong> <span id="outProf">-</span></p>
    <p><strong>Stamina:</strong> <span id="outStamina">-</span></p>
    <p id="outArmorNote" class="muted" style="margin-top:-6px">Armor: None</p>
    <p><strong>Hero Points:</strong> <span id="outHero">-</span></p>
    <p><strong>Carry Capacity:</strong> <span id="outCarry">-</span></p>
  </div>

  <div class="section">
    <h4>Languages</h4><div class="hr"></div>
    <p><strong>Languages:</strong> <span id="outLang">Common</span></p>
  </div>

  <div class="section">
    <h4>Skills</h4><div class="hr"></div>
    <ul id="outSkills"></ul>
  </div>

  <div class="section">
    <h4>Spells</h4><div class="hr"></div>
    <div id="spellBlock"><p>—</p></div>
  </div>

  <div class="section">
    <h4>Pouch</h4><div class="hr"></div>
    <p><strong>Gold:</strong> <span id="outGold">-</span> GP</p>
    <p><strong>Silver:</strong> <span id="outSilver">-</span> SP</p>
    <p><strong>Other:</strong> <span id="outOther">—</span></p>
  </div>

  <div class="section">
    <h4>Equipment</h4><div class="hr"></div>
    <ul id="outGear"></ul>
  </div>
</div>

<!-- ========== COMPANION DESIGNER & SHEET ========== -->
<div class="step hidden" id="ally">
  <h2>Animal Companion Designer</h2>
  <div class="grid2">
    <label>Name <input id="allyName" type="text" oninput="updateAlly()"></label>
    <label>Role / Type <input id="allyRole" type="text" placeholder="e.g., scout, mount" oninput="updateAlly()"></label>
    <label>Size
      <select id="allySize" onchange="updateAlly()">
        <option value="Small">Small (3 GP, 1#)</option>
        <option value="Medium">Medium (6 GP, 6#)</option>
        <option value="Large">Large (12 GP, 4P)</option>
      </select>
    </label>
    <label>Stamina <input id="allyStamina" type="number" min="1" value="1" oninput="updateAlly()"></label>
    <label>Carry <input id="allyCarry" type="text" value="1#" oninput="updateAlly()"></label>
    <label>Pull <input id="allyPull" type="text" value="2#" oninput="updateAlly()"></label>
    <label class="grow">Skills / Traits (comma separated)
      <input id="allySkills" type="text" placeholder="e.g., Keen Smell, Sure-Footed" oninput="updateAlly()">
    </label>
    <label class="grow">Gear (comma separated)
      <input id="allyGear" type="text" placeholder="e.g., Saddle, Saddlebags" oninput="updateAlly()">
    </label>
  </div>
  <label class="grow">Notes
    <textarea id="allyNotes" placeholder="Any special abilities or GM notes." oninput="updateAlly()"></textarea>
  </label>
  <div>
    <button class="btn print-btn" onclick="printSheet('allySheet')">Download PDF</button>
    <button class="btn next-btn" onclick="copyDiscordAlly()">Copy for Discord</button>
    <button class="btn reset-btn" onclick="resetAlly()">Reset Companion</button>
    <button class="btn link-btn" onclick="route('home')">Back to Home</button>
  </div>
</div>

<div class="sheet hidden" id="allySheet">
  <h2 id="allyHeader">Animal Companion</h2>
  <div class="section"><h4>Identity</h4><div class="hr"></div>
    <p><strong>Name:</strong> <span id="allyOutName">-</span></p>
    <p><strong>Type:</strong> <span id="allyOutRole">-</span></p>
    <p><strong>Size:</strong> <span id="allyOutSize">Small (3 GP, 1#)</span></p>
  </div>
  <div class="section"><h4>Stats</h4><div class="hr"></div>
    <p><strong>Stamina:</strong> <span id="allyOutStamina">1</span></p>
    <p><strong>Carry:</strong> <span id="allyOutCarry">1#</span></p>
    <p><strong>Pull:</strong> <span id="allyOutPull">2#</span></p>
  </div>
  <div class="section"><h4>Skills / Traits</h4><div class="hr"></div>
    <ul id="allyOutSkills"><li>—</li></ul>
  </div>
  <div class="section"><h4>Gear</h4><div class="hr"></div>
    <ul id="allyOutGear"><li>—</li></ul>
  </div>
  <div class="section"><h4>Notes</h4><div class="hr"></div>
    <p id="allyOutNotes">—</p>
  </div>
</div>

<!-- ========== HIRELING DESIGNER & SHEET ========== -->
<div class="step hidden" id="hire">
  <h2>Hireling Designer</h2>
  <div class="grid2">
    <label>Name <input id="hireName" type="text" oninput="updateHire()"></label>
    <label>Role / Job <input id="hireRole" type="text" placeholder="e.g., porter, guard" oninput="updateHire()"></label>
    <label>Community Skill <input id="hireCmmSkill" type="text" placeholder="choose 1" oninput="updateHire()"></label>
    <label>Role Skill <input id="hireRoleSkill" type="text" placeholder="choose 1" oninput="updateHire()"></label>
    <label>Stamina <input id="hireStamina" type="number" min="1" value="2" oninput="updateHire()"></label>
    <label>Can Cast 1 Spell?
      <select id="hireSpellYN" onchange="updateHire()">
        <option value="No">No</option><option value="Yes">Yes</option>
      </select>
    </label>
    <label class="grow">If Yes, Spell Name <input id="hireSpellName" type="text" oninput="updateHire()"></label>
    <label class="grow">Gear (comma separated) <input id="hireGear" type="text" placeholder="You must equip them!" oninput="updateHire()"></label>
  </div>
  <div class="panel">
    <h3>Hireling Statline (Rules)</h3>
    <ul>
      <li>Cost: Paid per adventure (GM sets fee).</li>
      <li>Equipment: Hero must provide weapons, armor, gear.</li>
      <li>Carry Capacity: 6#.</li>
      <li>Pull Capacity: 6# per 1H carried (each 1H = –1D penalty).</li>
      <li>Skills: Starts with <em>1 Community Skill</em> and <em>1 Role Skill</em> (chosen by the Hero).</li>
      <li>Stamina: 2 (editable above).</li>
      <li>Magic: May know max. 1 spell (if applicable).</li>
      <li>Actions/Reactions: Player rolls 1D for them (1 = 1 Success, apply bonuses/penalties).</li>
      <li>Control: GM roleplays the hireling.</li>
    </ul>
  </div>
  <div>
    <button class="btn print-btn" onclick="printSheet('hireSheet')">Download PDF</button>
    <button class="btn next-btn" onclick="copyDiscordHire()">Copy for Discord</button>
    <button class="btn reset-btn" onclick="resetHire()">Reset Hireling</button>
    <button class="btn link-btn" onclick="route('home')">Back to Home</button>
  </div>
</div>

<div class="sheet hidden" id="hireSheet">
  <h2>Hireling Sheet</h2>
  <div class="section"><h4>Identity</h4><div class="hr"></div>
    <p><strong>Name:</strong> <span id="hireOutName">-</span></p>
    <p><strong>Role / Job:</strong> <span id="hireOutRole">-</span></p>
  </div>
  <div class="section"><h4>Stats</h4><div class="hr"></div>
    <p><strong>Stamina:</strong> <span id="hireOutStamina">2</span></p>
    <p><strong>Carry:</strong> 6#</p>
    <p><strong>Pull:</strong> 6# per 1H (–1D / 1H)</p>
  </div>
  <div class="section"><h4>Skills</h4><div class="hr"></div>
    <ul id="hireOutSkills"><li>Community Skill: —</li><li>Role Skill: —</li></ul>
  </div>
  <div class="section"><h4>Magic</h4><div class="hr"></div>
    <p><strong>Can cast 1 spell?</strong> <span id="hireOutSpellYN">No</span></p>
    <p><strong>Spell Name:</strong> <span id="hireOutSpellName">—</span></p>
  </div>
  <div class="section"><h4>Gear</h4><div class="hr"></div>
    <ul id="hireOutGear"><li>—</li></ul>
  </div>
</div>

<!-- ========== GENERAL STORE (read-only) ========== -->
<div class="step hidden" id="store">
  <h2>General Store</h2>
  <p class="muted">Browse items. Use the Character Creator to buy & add gear.</p>
  <h3>1 GP Items</h3><ul id="store1"></ul>
  <h3>3 GP Items</h3><ul id="store3"></ul>
  <h3>6 GP Items</h3><ul id="store6"></ul>
  <p class="muted" id="storeFoot"></p>
  <button class="btn link-btn" onclick="route('home')">Back to Home</button>
</div>

<script>
/* ---------- Shortcuts ---------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

/* ---------- Routing ---------- */
function route(id){
  ['home','char-1','char-2','char-3','char-4','char-5','char-6','char-7','char-8','ally','hire','store']
    .forEach(k => { const el = document.getElementById(k); if(el) el.classList.add('hidden'); });

  ['charSheet','allySheet','hireSheet'].forEach(sid=>{
    const sEl=document.getElementById(sid);
    if(sEl) sEl.classList.add('hidden');
  });

  const el = document.getElementById(id);
  if(el) el.classList.remove('hidden');

  if(id.startsWith('char-')) { $('#charSheet').classList.remove('hidden'); }
  else if(id==='ally') { $('#allySheet').classList.remove('hidden'); }
  else if(id==='hire') { $('#hireSheet').classList.remove('hidden'); }

  updateChar(); updateAlly(); updateHire();
}

/* Print one sheet */
function printSheet(sheetId){
  $$('.sheet').forEach(s => s.classList.remove('printing'));
  const target = document.getElementById(sheetId);
  if(!target) return;
  const wasHidden = target.classList.contains('hidden');
  if(wasHidden) target.classList.remove('hidden');
  target.classList.add('printing');
  window.print();
  target.classList.remove('printing');
  if(wasHidden) target.classList.add('hidden');
}

/* Copy helper */
async function copyText(text){
  try{
    const ta=document.createElement("textarea");
    ta.value=text; ta.setAttribute("readonly",""); ta.style.position="fixed"; ta.style.top="-1000px";
    document.body.appendChild(ta); ta.focus(); ta.select(); ta.setSelectionRange(0, ta.value.length);
    const ok=document.execCommand("copy"); document.body.removeChild(ta);
    if(navigator.clipboard && window.isSecureContext){ try{ await navigator.clipboard.writeText(text); }catch(e){} }
    alert(ok ? "Copied to clipboard!" : "Tried to copy — if it didn’t work, press Ctrl/Cmd+C.");
    return ok;
  }catch(e){ console.error(e); alert("Copy failed — press Ctrl/Cmd+C."); return false; }
}

/* Discord helpers */
function toBold(s){ return s
  .replace(/[A-Z]/g,c=>String.fromCodePoint(c.charCodeAt(0)-0x41+0x1D400))
  .replace(/[a-z]/g,c=>String.fromCodePoint(c.charCodeAt(0)-0x61+0x1D41A))
  .replace(/[0-9]/g,d=>String.fromCodePoint(d.charCodeAt(0)-0x30+0x1D7CE)); }
const smallCapsMap={a:"ᴀ",b:"ʙ",c:"ᴄ",d:"ᴅ",e:"ᴇ",f:"ꜰ",g:"ɢ",h:"ʜ",i:"ɪ",j:"ᴊ",k:"ᴋ",l:"ʟ",m:"ᴍ",n:"ɴ",o:"ᴏ",p:"ᴘ",q:"ǫ",r:"ʀ",s:"s",t:"ᴛ",u:"ᴜ",v:"ᴠ",w:"ᴡ",x:"x",y:"ʏ",z:"ᴢ"};
function toSmallCaps(s){ return s.split("").map(ch=>smallCapsMap[ch.toLowerCase()]||ch).join(""); }
function fontify(s,mode){ if(mode==="bold") return toBold(s); if(mode==="smallcaps") return toSmallCaps(s); return s; }
const ANSI={reset:"\u001b[0m", fg:{none:"",green:"\u001b[32m",blue:"\u001b[34m",red:"\u001b[31m",yellow:"\u001b[33m",magenta:"\u001b[35m",cyan:"\u001b[36m",white:"\u001b[37m",gray:"\u001b[90m"}}; 
function colorize(s,c){ return c==="none" ? s : ANSI.fg[c] + s + ANSI.reset; }
function makeDivider(kind){ const w=40; if(kind==="double")return"═".repeat(w); if(kind==="heavy")return"━".repeat(w); if(kind==="equals")return"=".repeat(w); return"─".repeat(w); }
function frameTitle(txt,frame){ if(frame==="none")return txt; if(frame==="brackets")return`[ ${txt} ]`; if(frame==="rounded")return`╭ ${txt} ╮`; if(frame==="heavy")return`┏ ${txt} ┓`; if(frame==="double")return`╔ ${txt} ╗`; return txt; }

/* ---------- Character data/state ---------- */
function rollDice(s){ return Math.floor(Math.random()*s)+1; }
let gp, sp, gear, purchaseHistory = [];
let avatarDataURL="", avatarFilename="", pouchOthers=[];

/* base skills */
const skillsDB = {
  Dwarf:["Detect","Teamwork"], Elf:["Acrobatics","Pathfinder"], Goblin:["Darksee","Underground"],
  Halfling:["Hide","Willpower"], Human:["Parley","Languages (+2)"], Orc:["Athletics","Resilience"],
  Archer:["Launched Weapons","1H Throw"], Barbarian:["2H Weapons","2H Throw"],
  Cleric:["Religion"], Rogue:["Sneak","Tinker"], Warrior:["1H Weapons","Unarmed"], Wizard:["Arcana"]
};

/* Shop + notes (ARMOR updated) */
const shop={ gp1:["Acid","Caltrops","Candles (6)","Fire Pot","Grappling Hook","Oil (6)","Pitons (6)","Provisions (6)","Rope","Small Mirror","Tinderbox","Torches (6)"],
             gp3:["Animal Companion (Small)","Armor","Heavy Armor","Arrows (6)","Cart","Lantern","Net","Bolas","Shield","Heavy Shield","Spyglass","Throwing Blades (6)","Tinker Tools","Specialist Tools","Weapon (1H/2H)","Silver Weapon"],
             gp6:["Healing Kit/Herbs (6)","Hireling","Holy Water","Magic Recharge +1","Poison","Potion","Scroll","Spellcasting Item"] };

const itemNotes={
  "Armor":"+1 Stamina; ½ Move to Climb & Swim",
  "Heavy Armor":"+2 Stamina; ½ Move to Climb & Swim; -1D Dodge",
  "Shield":"Block: +1D; may negate all DMG once/round",
  "Heavy Shield":"Block: auto-negate 1 attack/round if successful",
  "Silver Weapon":"+1 DMG vs Undead/Evil; breaks on 1/6",
  "Cart":"-1D when pulling",
  "Animal Companion (Small)":"Stamina 1; carry 1#; pull 2#",
  "Animal Companion (Medium)":"Stamina 2; carry 3#; pull 6#",
  "Animal Companion (Large)":"Stamina 3; carry 1P; pull 2P",
  "Hireling":"Stamina 2; carries 6#; 1 Community + 1 Role skill"
};
function formatItem(n){ return itemNotes[n] ? `${n} (${itemNotes[n]})` : n; }

/* General Store text */
const storeCatalog = {
  gp1:[["Acid","1 DMG or dissolves 1# Item (e.g., armor or lock)"],["Caltrops","Traverse = halves Move or 1 DMG"],["Candles (6)","Near (Lantern), 1h each"],["Fire Pot","1 Fire DMG on impact"],["Grappling Hook","—"],["Oil (6)","1h each"],["Pitons (6)","Needs hammer"],["Provisions (6)","1/day (2 for Large)"],["Rope","Far length"],["Small Mirror","—"],["Tinderbox","—"],["Torches (6)","Near light, 1h"]],
  gp3:[["Animal Companion*","Small/Medium/Large"],["Armor / Heavy","+1 or +2 Stamina; penalties listed on sheet"],["Arrows (6)","Retrieve 3/6"],["Cart","Per 6# load; -1D pull"],["Lantern","Near open / Far point beam"],["Net / Bolas","2H throw snare / 1H"],["Shield / Heavy","Block; heavy can fully negate once/round if success"],["Spyglass","—"],["Throwing Blades (6)","Retrieve 3/6"],["Tinker / Specialist Tools","Locks / chosen profession"],["Weapon / Silver","1H/2H; silver x2 cost, +1 DMG vs vuln, break 1/6"]],
  gp6:[["Healing Kit/Herbs (6)","Std MIND = -1 DMG"],["Hireling*","See rules"],["Holy Water","2 DMG vs Evil"],["Magic Recharge +1","Recharge artefacts"],["Poison","Check might/size; fail=1 DMG & -1D +1D R"],["Potion","2 successes, 1-use"],["Scroll","Far; Std MIND=2 succ; no drain on success/fail"],["Spellcasting Item/Weapon","Unique to caster; -1D without"]],
  foot:"* Combined companions/hirelings ≤ (6 − Proficiency)."
};
function renderStore(){
  const makeLis = arr => arr.map(([n,d])=>`<li><strong>${n}</strong>${d && d!=='—' ? ` — ${d}` : ''}</li>`).join("");
  $("#store1").innerHTML = makeLis(storeCatalog.gp1);
  $("#store3").innerHTML = makeLis(storeCatalog.gp3);
  $("#store6").innerHTML = makeLis(storeCatalog.gp6);
  $("#storeFoot").innerText = storeCatalog.foot;
}

/* Shop rendering/buy/undo */
function initShop(){
  const make = (sel,list,cost) => { $(sel).innerHTML = list.map(it=>`<button class="buy-btn" onclick="buyItem('${it}',${cost})">${it} (${cost} GP)</button>`).join(" "); };
  make("#shop1",shop.gp1,1); make("#shop3",shop.gp3,3); make("#shop6",shop.gp6,6);
}
function buyItem(name,cost){
  if(gp>=cost){ gp-=cost; gear.push(formatItem(name)); purchaseHistory.push({name:formatItem(name), cost}); updateChar(); }
  else if(confirm(`Not enough GP (${gp} left). Buy ${name} anyway and go into debt?`)){
    gp-=cost; gear.push(formatItem(name)); purchaseHistory.push({name:formatItem(name), cost}); updateChar();
  }
}
function undoLastPurchase(){
  const last = purchaseHistory.pop();
  if(!last){ alert("Nothing to undo."); return; }
  const idx = gear.lastIndexOf(last.name);
  if(idx>-1) gear.splice(idx,1);
  gp += last.cost;
  updateChar();
}

/* Other (pouch/equipment) */
function addOther(){
  const raw = ($("#pouchOtherInput").value||"").trim();
  if(!raw){ alert("Type something to add."); return; }
  const dest = (document.querySelector('input[name="otherDest"]:checked')||{}).value || "pouch";
  if(dest==="equipment") gear.push(raw); else pouchOthers.push(raw);
  $("#pouchOtherInput").value=""; updateChar();
}

/* Numbered equipment list (0# base; pouch contents not duplicated) */
function numberedGearLines(){
  const base0 = `0#: Adventurer's Clothing; Backpack; Pouch`;
  const rest = (gear||[]).filter(it => it!=="Clothing" && it!=="Backpack");
  return [base0, ...rest.map((it,i)=>`${i+1}#: ${it}`)];
}

/* Determine equipped armor and bonus */
function getEquippedArmor(){
  // Look for explicit Armor and Heavy Armor in gear (formatted with notes)
  const hasHeavy = (gear||[]).some(g => /^Heavy Armor\b/.test(g));
  const hasArmor = (gear||[]).some(g => /^Armor\b/.test(g));
  if(hasHeavy) return { type:"Heavy Armor", bonus:2, note:"Heavy Armor (+2 Stamina; ½ Move to Climb & Swim; -1D Dodge)" };
  if(hasArmor) return { type:"Armor", bonus:1, note:"Armor (+1 Stamina; ½ Move to Climb & Swim)" };
  return { type:"None", bonus:0, note:"Armor: None" };
}

/* Avatar */
function loadAvatar(e){
  const f=e.target.files?.[0]; if(!f){ avatarDataURL=""; avatarFilename=""; updateChar(); return; }
  avatarFilename = f.name || "portrait.png";
  const r=new FileReader(); r.onload = ev => { avatarDataURL = ev.target.result; $("#avatar").src=avatarDataURL; updateChar(); }; r.readAsDataURL(f);
}
function downloadAvatar(){
  if(!avatarDataURL){ alert("No image uploaded yet."); return; }
  const a=document.createElement("a");
  const safe=($("#outName").innerText||"character").trim().replace(/[^a-z0-9_\-]+/gi,"_")||"character";
  const ext=(avatarFilename.split(".").pop()||"png").toLowerCase();
  a.href=avatarDataURL; a.download=`${safe}_portrait.${ext}`; document.body.appendChild(a); a.click(); a.remove();
}

/* STEP 1 logic: show/hide custom boxes */
function onCommunityChange(){
  const val=$("#community").value;
  $("#customCommunityBox").classList.toggle("hidden", val!=="__custom__");
  updateChar();
}
function onRoleChange(){
  const val=$("#role").value;
  $("#customRoleBox").classList.toggle("hidden", val!=="__custom__");
  updateChar();
}

/* Character update (includes custom + armor stamina) */
function updateChar(){
  // Inputs
  const name=$("#name")?.value||"-";
  const home=$("#home")?.value||"-";
  const goal=$("#goal")?.value||"-";
  const app=$("#app")?.value||"-";
  const commSel=$("#community")?.value||"-";
  const roleSel=$("#role")?.value||"-";
  const prof=parseInt($("#prof")?.value)||"-";
  const hero=(prof!="-")?rollDice(6):"-";

  // Custom names & skills
  const customCommName=($("#customCommunityName")?.value||"").trim();
  const customCommSkills=[($("#customCommunitySkill1")?.value||"").trim(),($("#customCommunitySkill2")?.value||"").trim()].filter(Boolean);
  const customRoleName=($("#customRoleName")?.value||"").trim();
  const customRoleSkills=[($("#customRoleSkill1")?.value||"").trim(),($("#customRoleSkill2")?.value||"").trim()].filter(Boolean);

  // Displayed community/role names
  const commName = (commSel==="__custom__" ? (customCommName||"Custom Community") : commSel);
  const roleName = (roleSel==="__custom__" ? (customRoleName||"Custom Role") : roleSel);

  // Languages
  let langs=["Common"];
  const langBox=$("#languageChoice");
  if(commSel==="Human"){
    if(langBox) langBox.classList.remove("hidden");
    let extras=[...($("#extraLang")?.selectedOptions||[])].map(o=>o.value);
    if(extras.length>2) extras=extras.slice(0,2);
    langs=langs.concat(extras);
  } else {
    if(langBox) langBox.classList.add("hidden");
    if(commSel && commSel!=="-"){
      const tongue = (commSel==="__custom__") ? `${commName} tongue` : `${commSel} tongue`;
      langs.push(tongue);
    }
  }

  // Skills
  const baseCommSkills = (commSel==="__custom__") ? customCommSkills : (skillsDB[commSel]||[]);
  const baseRoleSkills = (roleSel==="__custom__") ? customRoleSkills : (skillsDB[roleSel]||[]);
  const skillsList = baseCommSkills.concat(baseRoleSkills).map(s=>`<li>${s}</li>`).join("");

  // Spells
  const spellsArcane={"Darksee":"Self, see in greyscale for +1D R, Far","Levitate":"Self, +1R, 1 vertical Near Move per Round","Missile":"Far, bolt of energy, 1 DMG","Protection":"Self, -1 DMG from 1 Attack per Round (Free Action; no Spell Drain)","Speak":"Self, communicate with any sentient being for +1D R","Teleport":"Self, to 1 previously visited spot, Far"};
  const spellsHoly={"Bless":"Touch, +1D to 1 Proficiency Check next Round","Divine":"Touch, reveal beyond/within 1 structure, Near","Heal":"Touch, restore 1 Stamina point","Light":"Touch, as if day, for +1D R, Near","Smite":"Touch, Holy Weapon +1 DMG (Free Action; no Spell Drain)","Ward":"Far, prevent 1 Target’s 1 Move into your Melee area within +1D R"};
  const sb=$("#spellBlock");
  if(roleName==="Wizard"){ sb.innerHTML = "<ul>"+Object.entries(spellsArcane).map(([k,v])=>`<li>${k}: ${v}</li>`).join("")+"</ul>"; }
  else if(roleName==="Cleric"){ sb.innerHTML = "<ul>"+Object.entries(spellsHoly).map(([k,v])=>`<li>${k}: ${v}</li>`).join("")+"</ul>"; }
  else { sb.innerHTML = "<p>—</p>"; }

  // Armor & Stamina
  const equip = getEquippedArmor();
  const baseStamina = (prof!="-") ? prof : "-";
  const staminaTotal = (prof!="-") ? (prof + equip.bonus) : "-";

  // Carry Capacity = Proficiency + 6
  const carryCap = (prof!="-") ? (prof+6) : "-";

  // Output to sheet
  $("#outName").innerText=name;
  $("#outHome").innerText=home;
  $("#outGoal").innerText=goal;
  $("#outApp").innerText=app;
  $("#outCommunity").innerText=commName;
  $("#outRole").innerText=roleName;
  $("#outProf").innerText=prof;
  $("#outStamina").innerText=staminaTotal;
  $("#outArmorNote").innerText = (equip.type==="None") ? "Armor: None" : `Armor: ${equip.note}`;
  $("#outHero").innerText=hero;
  $("#outLang").innerText=langs.join(", ");
  $("#outCarry").innerText=carryCap;
  $("#outSkills").innerHTML=skillsList || "<li>—</li>";

  // Equipment numbered
  $("#outGear").innerHTML = numberedGearLines().map(l=>`<li>${l}</li>`).join("");

  // Pouch values
  $("#gold").innerText=gp; $("#silver").innerText=sp;
  $("#outGold").innerText=gp; $("#outSilver").innerText=sp;
  $("#outOther").innerText=(pouchOthers.length?pouchOthers.join("; "):"—");

  // Image on sheet
  const aS=$("#avatarSheet");
  if(aS){ if(avatarDataURL){ aS.src=avatarDataURL; aS.style.display="block"; } else { aS.removeAttribute("src"); aS.style.display="none"; } }
}

/* Discord: Character (includes armor note) */
function buildDiscordChar(){
  const DIV=$("#dsDivider")?.value||"dash", FONT=$("#dsFont")?.value||"normal", COLOR=$("#dsColor")?.value||"none", FRAME=$("#dsFrame")?.value||"none";
  const divider=makeDivider(DIV), hdr=t=>colorize(fontify(frameTitle(t,FRAME),FONT),COLOR);
  const get=id=>(document.getElementById(id)?.innerText||"-").toString();
  const spellsText=document.getElementById("spellBlock").innerText.trim();
  const out=[];
  out.push(hdr("AGE OF ADVENTURE — CHARACTER SHEET")); out.push(divider);
  out.push(hdr("IDENTITY"));
  out.push(`Name: ${get("outName")}`); out.push(`Community: ${get("outCommunity")}`); out.push(`Role: ${get("outRole")}`); out.push(`Homeland: ${get("outHome")}`);
  if(get("outGoal")!=="-") out.push(`Goal: ${get("outGoal")}`); if(get("outApp")!=="-") out.push(`Appearance: ${get("outApp")}`);
  if(avatarDataURL){ const safe=(get("outName")||"character").trim().replace(/[^a-z0-9_\-]+/gi,"_")||"character"; const ext=(($("#imgInput")?.files?.[0]?.name || "png").split(".").pop()||"png").toLowerCase(); out.push(`Image: ${safe}_portrait.${ext} (attach this file when posting)`); }
  out.push(divider);
  out.push(hdr("STATS"));
  out.push(`Proficiency: ${get("outProf")}`);
  out.push(`Stamina: ${get("outStamina")}`);
  out.push(`${get("outArmorNote")}`);
  out.push(`Hero Points: ${get("outHero")}`);
  out.push(`Carry Capacity: ${get("outCarry")}`);
  out.push(divider);
  out.push(hdr("LANGUAGES")); out.push(`Languages: ${get("outLang")}`); out.push(divider);
  out.push(hdr("SKILLS")); const skl=[...document.querySelectorAll("#outSkills li")].map(li=>li.innerText); if(skl.length) skl.forEach(s=>out.push(`• ${s}`)); else out.push("—"); out.push(divider);
  out.push(hdr("SPELLS")); out.push(spellsText || "—"); out.push(divider);
  out.push(hdr("POUCH")); out.push(`Gold: ${get("outGold")} GP`); out.push(`Silver: ${get("outSilver")} SP`); out.push(`Other: ${get("outOther")}`); out.push(divider);
  out.push(hdr("EQUIPMENT")); numberedGearLines().forEach(l=>out.push(l));
  const needsAnsi = (COLOR!=="none"); return (needsAnsi?"```ansi\n":"```\n")+out.join("\n")+"\n```";
}
async function copyDiscordChar(){ await copyText(buildDiscordChar()); }

/* ---------- Companion logic ---------- */
function updateAlly(){
  const sizeDefaults={ Small:{stamina:1,carry:"1#",pull:"2#",label:"Small (3 GP, 1#)"},
                       Medium:{stamina:2,carry:"3#",pull:"6#",label:"Medium (6 GP, 6#)"},
                       Large:{stamina:3,carry:"1P",pull:"2P",label:"Large (12 GP, 4P)"} };
  const sizeKey = (document.getElementById('allySize')?.value || "Small");
  const d = sizeDefaults[sizeKey];
  $("#allyStamina").value=d.stamina; $("#allyCarry").value=d.carry; $("#allyPull").value=d.pull;

  const name=($("#allyName")?.value||"-").trim(), role=($("#allyRole")?.value||"-").trim();
  const skills=($("#allySkills")?.value||"").split(",").map(s=>s.trim()).filter(Boolean);
  const gear=($("#allyGear")?.value||"").split(",").map(s=>s.trim()).filter(Boolean);
  const notes=($("#allyNotes")?.value||"—").trim();

  $("#allyHeader").innerText="Animal Companion";
  $("#allyOutSize").innerText=d.label;
  $("#allyOutName").innerText=name || "-";
  $("#allyOutRole").innerText=role || "-";
  $("#allyOutStamina").innerText=$("#allyStamina").value;
  $("#allyOutCarry").innerText=$("#allyCarry").value;
  $("#allyOutPull").innerText=$("#allyPull").value;
  $("#allyOutNotes").innerText=notes || "—";
  $("#allyOutSkills").innerHTML = skills.length ? skills.map(s=>`<li>${s}</li>`).join("") : "<li>—</li>";
  $("#allyOutGear").innerHTML   = gear.length   ? gear.map(s=>`<li>${s}</li>`).join("")   : "<li>—</li>";
}
function resetAlly(){
  $("#allyName").value=""; $("#allyRole").value="";
  $("#allySize").value="Small"; $("#allyStamina").value=1; $("#allyCarry").value="1#"; $("#allyPull").value="2#";
  $("#allySkills").value=""; $("#allyGear").value=""; $("#allyNotes").value="";
  updateAlly(); route('ally');
}
function buildDiscordAlly(){
  const out=[];
  out.push("```");
  out.push("ANIMAL COMPANION");
  out.push("────────");
  out.push(`Name: ${$("#allyOutName").innerText}`);
  out.push(`Type: ${$("#allyOutRole").innerText}`);
  out.push(`Size: ${$("#allyOutSize").innerText}`);
  out.push("────────");
  out.push("STATS");
  out.push(`Stamina: ${$("#allyOutStamina").innerText}`);
  out.push(`Carry: ${$("#allyOutCarry").innerText}`);
  out.push(`Pull: ${$("#allyOutPull").innerText}`);
  out.push("────────");
  out.push("SKILLS / TRAITS");
  const s=[...document.querySelectorAll("#allyOutSkills li")].map(li=>li.innerText); out.push(s.length?s.join("\n"):"—");
  out.push("────────");
  out.push("GEAR");
  const g=[...document.querySelectorAll("#allyOutGear li")].map(li=>li.innerText); out.push(g.length?g.join("\n"):"—");
  out.push("────────");
  out.push("NOTES");
  out.push($("#allyOutNotes").innerText || "—");
  out.push("```");
  return out.join("\n");
}
async function copyDiscordAlly(){ await copyText(buildDiscordAlly()); }

/* ---------- Hireling logic ---------- */
function updateHire(){
  const name=($("#hireName")?.value||"-").trim(), role=($("#hireRole")?.value||"-").trim();
  const cmm=($("#hireCmmSkill")?.value||"-").trim(), rsk=($("#hireRoleSkill")?.value||"-").trim();
  const sta=$("#hireStamina")?.value||2, yn=$("#hireSpellYN")?.value||"No", spn=($("#hireSpellName")?.value||"—").trim();
  const gear=($("#hireGear")?.value||"").split(",").map(s=>s.trim()).filter(Boolean);

  $("#hireOutName").innerText=name||"-"; $("#hireOutRole").innerText=role||"-";
  $("#hireOutStamina").innerText=sta;
  $("#hireOutSkills").innerHTML = `<li>Community Skill: ${cmm||"—"}</li><li>Role Skill: ${rsk||"—"}</li>`;
  $("#hireOutSpellYN").innerText=yn; $("#hireOutSpellName").innerText= (yn==="Yes" ? (spn||"—") : "—");
  $("#hireOutGear").innerHTML = gear.length ? gear.map(s=>`<li>${s}</li>`).join("") : "<li>—</li>";
}
function resetHire(){
  ["hireName","hireRole","hireCmmSkill","hireRoleSkill","hireGear","hireSpellName"].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=""; });
  $("#hireStamina").value=2; $("#hireSpellYN").value="No"; updateHire(); route('hire');
}
function buildDiscordHire(){
  const out=[];
  out.push("```");
  out.push("HIRELING");
  out.push("────────");
  out.push(`Name: ${$("#hireOutName").innerText}`);
  out.push(`Role / Job: ${$("#hireOutRole").innerText}`);
  out.push("────────");
  out.push("STATS");
  out.push(`Stamina: ${$("#hireOutStamina").innerText}`);
  out.push(`Carry: 6#`);
  out.push(`Pull: 6# per 1H (–1D / 1H)`);
  out.push("────────");
  out.push("SKILLS");
  [...document.querySelectorAll("#hireOutSkills li")].forEach(li=>out.push(li.innerText));
  out.push("────────");
  out.push("MAGIC");
  out.push(`Can cast 1 spell? ${$("#hireOutSpellYN").innerText}`);
  out.push(`Spell Name: ${$("#hireOutSpellName").innerText}`);
  out.push("────────");
  out.push("GEAR");
  const g=[...document.querySelectorAll("#hireOutGear li")].map(li=>li.innerText); out.push(g.length?g.join("\n"):"—");
  out.push("```");
  return out.join("\n");
}
async function copyDiscordHire(){ await copyText(buildDiscordHire()); }

/* ---------- Init ---------- */
function resetAll(){
  gp=12+rollDice(6); sp=rollDice(6); gear=["Clothing","Backpack"]; purchaseHistory=[]; pouchOthers=[];
  avatarDataURL=""; avatarFilename="";
  ["community","role","name","home","goal","app","prof","pouchOtherInput",
   "customCommunityName","customCommunitySkill1","customCommunitySkill2",
   "customRoleName","customRoleSkill1","customRoleSkill2"].forEach(id=>{ const el=document.getElementById(id); if(el){ if(el.tagName==="SELECT") el.selectedIndex=0; else el.value=""; } });
  $("#customCommunityBox").classList.add("hidden");
  $("#customRoleBox").classList.add("hidden");
  const img=$("#imgInput"); if(img) img.value="";
  const r=document.querySelector('input[name="otherDest"][value="pouch"]'); if(r) r.checked=true;
  ["dsDivider","dsFont","dsColor","dsFrame"].forEach(id=>{ const el=document.getElementById(id); if(el) el.selectedIndex=0; });
  updateChar(); route('home');
}
function init(){
  initShop(); renderStore();
  gp=12+rollDice(6); sp=rollDice(6); gear=["Clothing","Backpack"]; purchaseHistory=[]; pouchOthers=[];
  updateChar(); updateAlly(); updateHire();
  route('home');
}
init();
</script>
</body>
</html>


  
